# Maestro Quick Reference

A quick reference guide for common Maestro commands and patterns.

## üé¨ Basic Commands

### App Control
```yaml
# Launch app
- launchApp

# Launch with cleared state
- launchApp:
    clearState: true

# Launch with permissions
- launchApp:
    permissions:
      location: allow
      camera: deny
      notifications: allow

# Launch with deep link
- launchApp:
    url: "myapp://screen/123"

# Stop app
- stopApp

# Clear app state
- clearState

# Clear keychain (iOS)
- clearKeychain
```

### Interactions
```yaml
# Tap on element
- tapOn: "Button Text"

# Tap by ID
- tapOn:
    id: "my-button-id"

# Tap by accessibility label
- tapOn:
    accessibilityLabel: "Submit"

# Long press
- longPressOn: "Element"

# Double tap
- tapOn: "Element"
- tapOn: "Element"

# Input text
- tapOn: "Email"
- inputText: "test@example.com"

# Clear text field
- clearTextField

# Hide keyboard
- hideKeyboard
```

### Scrolling
```yaml
# Scroll down
- scroll:
    direction: DOWN

# Scroll with speed
- scroll:
    direction: DOWN
    speed: 40

# Scroll until element visible
- scrollUntilVisible:
    element: "My Element"
    direction: DOWN

# Swipe
- swipe:
    direction: LEFT
    on: "Card"
```

### Assertions
```yaml
# Assert visible
- assertVisible: "Welcome"

# Assert visible by ID
- assertVisible:
    id: "welcome-text"

# Assert not visible
- assertNotVisible: "Error"

# Assert with timeout
- assertVisible:
    text: "Loading complete"
    timeout: 10000

# Assert with regex
- assertVisible: "User.*logged.*in"
```

### Waits
```yaml
# Wait for animation to end
- waitForAnimationToEnd

# Wait with timeout
- waitForAnimationToEnd:
    timeout: 5000

# Wait for specific time
- wait: 2000

# Wait until visible
- waitForAnimationToEnd
- assertVisible: "Content"
```

## üéØ Advanced Patterns

### Conditional Logic
```yaml
# Platform-specific
- runScript:
    when: platform == 'iOS'
    script: echo "iOS specific"

- runScript:
    when: platform == 'Android'
    script: echo "Android specific"
```

### Environment Variables
```yaml
# In .env file:
# APP_ID=com.myapp
# TEST_EMAIL=test@example.com

# In flow:
appId: ${APP_ID}

- inputText: ${TEST_EMAIL}
```

### Repeat Actions
```yaml
# Repeat 5 times
- repeat:
    count: 5
    commands:
      - scroll:
          direction: DOWN
      - wait: 1000
```

### Running Sub-flows
```yaml
# Run helper flow
- runFlow: ../helpers/login.yaml

# Run with environment
- runFlow:
    file: ../helpers/setup.yaml
    env:
      USER: testuser
```

### Screenshots
```yaml
# Take screenshot
- takeScreenshot: screenshot-name

# Auto-named screenshot
- takeScreenshot
```

### Device Actions
```yaml
# Press back button (Android)
- back

# Press home button
- pressKey: Home

# Press enter
- pressKey: Enter

# Shake device
- shake

# Rotate device
- rotate
```

## üì± Platform-Specific

### iOS
```yaml
# Press iOS back button
- tapOn:
    accessibilityLabel: "Back"

# Swipe back (iOS gesture)
- swipe:
    direction: RIGHT
    from: 0,50%
    to: 100%,50%
```

### Android
```yaml
# Press Android back button
- back

# Open drawer
- swipe:
    direction: RIGHT
    from: 0,50%
```

## üé® Selector Types

### By Text
```yaml
- tapOn: "Submit"
```

### By ID (testID)
```yaml
- tapOn:
    id: "submit-button"
```

### By Accessibility Label
```yaml
- tapOn:
    accessibilityLabel: "Submit form"
```

### By Regex
```yaml
- assertVisible: "User.*Smith"
```

### By Position
```yaml
- tapOn:
    point: 50%,50%
```

### By Index
```yaml
- tapOn:
    text: "Item"
    index: 2
```

## üîç Common Patterns

### Login Flow
```yaml
- tapOn: "Email"
- inputText: ${TEST_EMAIL}
- tapOn: "Password"
- inputText: ${TEST_PASSWORD}
- hideKeyboard
- tapOn: "Login"
- assertVisible: "Welcome"
```

### Form Filling
```yaml
- tapOn: "Name"
- inputText: "John Doe"
- tapOn: "Email"
- inputText: "john@example.com"
- tapOn: "Phone"
- inputText: "1234567890"
- hideKeyboard
- tapOn: "Submit"
```

### List Navigation
```yaml
- scroll:
    direction: DOWN
- tapOn: "List Item 5"
- assertVisible: "Detail View"
- back
```

### Pull to Refresh
```yaml
- scroll:
    direction: UP
    speed: 100
- waitForAnimationToEnd
- assertVisible: "Updated content"
```

### Tab Navigation
```yaml
- tapOn: "Home Tab"
- assertVisible: "Home Screen"
- tapOn: "Profile Tab"
- assertVisible: "Profile Screen"
```

### Error Handling
```yaml
- tapOn: "Submit"
- assertVisible: "Error"
- tapOn: "OK"
- assertNotVisible: "Error"
```

## üè∑Ô∏è Tags

```yaml
# In flow:
tags:
  - smoke
  - critical
  - auth

# Run with tag:
# maestro test --tag smoke .maestro/flows
```

Common tags:
- `smoke` - Quick smoke tests
- `critical` - Critical user flows
- `regression` - Regression test suite
- `auth` - Authentication flows
- `slow` - Slow-running tests
- `flaky` - Known flaky tests (to fix)

## üêõ Debugging

### Verbose Output
```bash
maestro test --debug .maestro/flows/my-flow.yaml
```

### Studio Mode
```bash
maestro studio
```

### View Hierarchy
```bash
maestro hierarchy
```

### Screenshots on Failure
```yaml
# Screenshots are automatically taken on failure
# Located in: ~/.maestro/tests/<timestamp>/
```

## ‚ö° Performance Tips

1. **Use testIDs**: Faster and more reliable than text
```yaml
- tapOn:
    id: "my-button"  # Fast
# vs
- tapOn: "My Button"  # Slower
```

2. **Explicit waits**: Better than fixed delays
```yaml
- waitForAnimationToEnd  # Good
# vs
- wait: 3000  # Avoid
```

3. **Minimize scrolling**: Scroll to specific elements
```yaml
- scrollUntilVisible:
    element: "Target"  # Better
# vs
- repeat: 10
    commands:
      - scroll: DOWN  # Slower
```

## üìù Best Practices

1. **One flow = One user journey**
2. **Use descriptive names**
3. **Add comments**
4. **Keep flows independent**
5. **Use environment variables for secrets**
6. **Tag tests appropriately**
7. **Take screenshots at key points**
8. **Clear state between test runs**

## üîó Useful Links

- [Official Docs](https://maestro.mobile.dev/)
- [Command Reference](https://maestro.mobile.dev/reference/commands)
- [Examples](https://github.com/mobile-dev-inc/maestro/tree/main/maestro-test/src/test/resources)
- [Maestro Cloud](https://cloud.mobile.dev/)

## üí° Quick Tips

```yaml
# Combine assertions
- assertVisible:
    text: "Success"
    timeout: 5000

# Multiple taps
- tapOn: "Element"
- tapOn: "Element"  # Double tap

# Swipe to dismiss
- swipe:
    direction: DOWN

# Test offline
- runScript: |
    adb shell svc wifi disable  # Android
    # iOS: Toggle in Settings app

# Check element state
- assertVisible: "Enabled"
- assertNotVisible: "Disabled"
```

---

**Pro Tip**: Use `maestro studio` to explore your app's UI hierarchy and generate selectors!
