# Maestro Test Suite for React Native/Expo

This directory contains Maestro E2E tests for automated UI testing.

## ğŸš€ Quick Start

### Installation

```bash
# Install Maestro CLI
curl -Ls "https://get.maestro.mobile.dev" | bash

# Verify installation
maestro --version
```

### Setup

1. Copy the environment file and fill in your app details:
```bash
cp .maestro/.env.example .maestro/.env
```

2. Update `.maestro/.env` with your app's bundle identifier and test credentials

3. Make sure you have a simulator/emulator running or a physical device connected

### Running Tests

```bash
# Run all tests
maestro test .maestro/flows

# Run a specific test
maestro test .maestro/flows/01-app-launch.yaml

# Run tests with specific tag
maestro test --tag smoke .maestro/flows

# Run tests on iOS
maestro test --platform ios .maestro/flows

# Run tests on Android
maestro test --platform android .maestro/flows

# Run with environment variables
maestro test --env APP_ID=com.yourapp .maestro/flows

# Run in continuous mode (watches for changes)
maestro test --continuous .maestro/flows
```

### Running on Specific Devices

```bash
# List available devices
maestro test --help

# iOS Simulator
xcrun simctl list devices

maestro test --device "iPhone 15 Pro" .maestro/flows

# Android Emulator
emulator -list-avds

maestro test --device emulator-5554 .maestro/flows

# Physical device (iOS)
maestro test --device "Your iPhone" .maestro/flows

# Physical device (Android)
adb devices
maestro test --device <device-id> .maestro/flows
```

## ğŸ“ Test Structure

```
.maestro/
â”œâ”€â”€ config.yaml           # Global configuration
â”œâ”€â”€ .env.example         # Environment variables template
â”œâ”€â”€ .env                 # Your environment variables (git-ignored)
â”œâ”€â”€ flows/               # Test flows
â”‚   â”œâ”€â”€ 01-app-launch.yaml
â”‚   â”œâ”€â”€ 02-user-auth.yaml
â”‚   â”œâ”€â”€ 03-form-validation.yaml
â”‚   â”œâ”€â”€ 04-list-scrolling.yaml
â”‚   â”œâ”€â”€ 05-network-loading.yaml
â”‚   â”œâ”€â”€ 06-deep-linking.yaml
â”‚   â”œâ”€â”€ 07-gestures.yaml
â”‚   â”œâ”€â”€ 08-permissions.yaml
â”‚   â”œâ”€â”€ 09-accessibility.yaml
â”‚   â””â”€â”€ 10-performance.yaml
â””â”€â”€ helpers/             # Reusable flows
    â”œâ”€â”€ login.yaml
    â”œâ”€â”€ logout.yaml
    â””â”€â”€ background-app.yaml
```

## ğŸ¯ Test Coverage

- âœ… **App Launch** - Basic app startup and initialization
- âœ… **Authentication** - Login, signup, and logout flows
- âœ… **Form Validation** - Input validation and error handling
- âœ… **List Interactions** - Scrolling, refresh, and item selection
- âœ… **Network Loading** - Data fetching and loading states
- âœ… **Deep Linking** - URL scheme handling
- âœ… **Gestures** - Tap, swipe, long press interactions
- âœ… **Permissions** - Camera, location, notifications
- âœ… **Accessibility** - VoiceOver/TalkBack compatibility
- âœ… **Performance** - Stress testing and memory usage

## ğŸ› ï¸ Customization

### Updating Tests for Your App

1. **Update selectors**: Replace placeholder selectors like `"Button"` with your actual UI text or test IDs
2. **Add test IDs**: In your React Native components, add `testID` props:
   ```jsx
   <Button testID="login-button" title="Login" />
   ```
3. **Use test IDs in Maestro**:
   ```yaml
   - tapOn:
       id: "login-button"
   ```

### Adding New Tests

Create a new `.yaml` file in `.maestro/flows/`:

```yaml
appId: ${APP_ID}
name: My New Test
tags:
  - custom

---

- launchApp
- assertVisible: "My Screen"
- tapOn: "Button"
- assertVisible: "Result"
```

### Using Helper Flows

Reuse common flows to keep tests DRY:

```yaml
---
- launchApp
- runFlow: ../helpers/login.yaml
- tapOn: "My Feature"
# ... rest of your test
```

## ğŸ” Debugging

### View Test Output

Maestro provides detailed output including:
- Screenshots on failures
- Step-by-step execution logs
- Assertion results

### Interactive Mode

Run tests interactively to debug:

```bash
maestro studio
```

This opens a visual interface where you can:
- Record new flows
- Run commands interactively
- Inspect the UI hierarchy
- Debug failing tests

### Screenshots

Screenshots are automatically saved in:
- `~/.maestro/tests/<timestamp>/screenshots/`

You can also take manual screenshots:
```yaml
- takeScreenshot: my-screenshot-name
```

## ğŸš¦ CI/CD Integration

### GitHub Actions

```yaml
name: Maestro Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm install
      
      - name: Install Maestro
        run: curl -Ls "https://get.maestro.mobile.dev" | bash
      
      - name: Build iOS app
        run: npx expo prebuild --platform ios
      
      - name: Run Maestro tests
        run: maestro test .maestro/flows
        env:
          APP_ID: ${{ secrets.APP_ID }}
          TEST_EMAIL: ${{ secrets.TEST_EMAIL }}
          TEST_PASSWORD: ${{ secrets.TEST_PASSWORD }}
```

### Maestro Cloud

For faster CI runs, use Maestro Cloud:

```bash
# Upload and run tests in the cloud
maestro cloud --apiKey <your-api-key> \
  --app <path-to-app> \
  --flows .maestro/flows
```

## ğŸ“Š Test Reports

Generate detailed test reports:

```bash
# Run with JUnit output
maestro test --format junit --output test-results.xml .maestro/flows

# Generate HTML report (requires additional tooling)
# Use tools like junit2html or allure
```

## ğŸ”§ Troubleshooting

### Common Issues

**Tests can't find elements:**
- Add `testID` props to your React Native components
- Use more specific selectors
- Increase timeout values

**App doesn't launch:**
- Verify `APP_ID` matches your bundle identifier
- Ensure app is installed on the device/simulator
- Check simulator/emulator is running

**Flaky tests:**
- Add `waitForAnimationToEnd` after navigation
- Increase timeouts for slow operations
- Use more reliable selectors

### Tips

- Use `testID` instead of text for more reliable tests
- Add proper loading states in your app
- Test on multiple devices/simulators
- Keep tests independent and idempotent
- Use tags to organize and filter tests

## ğŸ“š Resources

- [Maestro Documentation](https://maestro.mobile.dev/)
- [Maestro GitHub](https://github.com/mobile-dev-inc/maestro)
- [Command Reference](https://maestro.mobile.dev/reference/commands)
- [Best Practices](https://maestro.mobile.dev/best-practices)

## ğŸ¤ Contributing

When adding new tests:
1. Follow the naming convention: `##-feature-name.yaml`
2. Add appropriate tags
3. Include helpful comments
4. Update this README
5. Test on both iOS and Android

## ğŸ“ Notes

- All test flows are commented with placeholder selectors
- Update selectors to match your actual app UI
- Environment variables should be stored in `.env` (not committed)
- Screenshots help debug failing tests
- Use helpers for common flows to reduce duplication
